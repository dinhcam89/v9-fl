(venv) cam@client2:~/flwr/v5-fl$ python client.py   --ipfs-url http://192.168.80.180:5001/api/v0   --server-address 192.168.80.180:8088   --ga-generations 3   --ga-population-size 10   --contract-address 0x760adD85eF476BdFd733B2Bf1c37A75A9CAa0e97   --wallet-address 0x432eeDFD74F3CD992689f1cC2c0cB2758DdAB7fe   --csv-file=data/clients/client_0.csv   --client-id client-0
2025-05-24 07:08:01,946 - federated.ipfs - INFO - Connected to IPFS node version: 0.34.1
2025-05-24 07:08:01,946 - FL-Client-Ensemble - INFO - Initialized IPFS connector: http://192.168.80.180:5001/api/v0
Using Ganache account: 0xb6845ba34Fc592266921419ef65b9b4D943e2797
Contract loaded at address: 0x760adD85eF476BdFd733B2Bf1c37A75A9CAa0e97
2025-05-24 07:08:01,989 - FL-Client-Ensemble - INFO - Initialized blockchain connector: http://192.168.80.1:7545
2025-05-24 07:08:01,989 - FL-Client-Ensemble - INFO - Using contract at: 0x760adD85eF476BdFd733B2Bf1c37A75A9CAa0e97
2025-05-24 07:08:01,989 - FL-Client-Ensemble - INFO - Using dataset file: data/clients/client_0.csv
2025-05-24 07:08:02,421 - FL-Client-Ensemble - INFO - Successfully loaded dataset with 56962 samples and 31 features
2025-05-24 07:08:02,429 - FL-Client-Ensemble - INFO - Target column: Class, Class distribution: {0: 56864, 1: 98}
2025-05-24 07:08:02,429 - FL-Client-Ensemble - INFO - DataFrame columns: ['Time', 'V1', 'V2', 'V3', 'V4', 'V5', 'V6', 'V7', 'V8', 'V9', 'V10', 'V11', 'V12', 'V13', 'V14', 'V15', 'V16', 'V17', 'V18', 'V19', 'V20', 'V21', 'V22', 'V23', 'V24', 'V25', 'V26', 'V27', 'V28', 'Amount', 'Class']
2025-05-24 07:08:02,453 - FL-Client-Ensemble - INFO - Features shape: (56962, 22), Target shape: (56962,)
2025-05-24 07:08:02,522 - FL-Client-Ensemble - INFO - Data info before SMOTE:
2025-05-24 07:08:02,522 - FL-Client-Ensemble - INFO - [BEFORE] Train: (45569, 22), Validation: (3797, 22), Test: (7596, 22)
2025-05-24 07:08:02,617 - FL-Client-Ensemble - INFO - SMOTE applied. New training shape: (90982, 22)
2025-05-24 07:08:02,617 - FL-Client-Ensemble - INFO - Preprocessing complete.
2025-05-24 07:08:02,617 - FL-Client-Ensemble - INFO - Train: (90982, 22), Validation: (3797, 22), Test: (7596, 22)
2025-05-24 07:08:02,618 - FL-Client-Ensemble - INFO - Data preprocessing complete:
2025-05-24 07:08:02,618 - FL-Client-Ensemble - INFO - - Training set: 90982 samples
2025-05-24 07:08:02,618 - FL-Client-Ensemble - INFO - - Validation set: 3797 samples
2025-05-24 07:08:02,618 - FL-Client-Ensemble - INFO - - Test set: 7596 samples
2025-05-24 07:08:02,618 - FL-Client-Ensemble - INFO - Initialized client-0 with GA-Stacking pipeline
2025-05-24 07:08:02,618 - FL-Client-Ensemble - INFO - IPFS node: http://192.168.80.180:5001/api/v0
2025-05-24 07:08:02,656 - FL-Client-Ensemble - INFO - Client 0x432eeDFD74F3CD992689f1cC2c0cB2758DdAB7fe is authorized on the blockchain ‚úÖ
2025-05-24 07:08:02,685 - flwr - DEBUG - Opened insecure gRPC connection (no certificates were passed)
2025-05-24 07:08:02,686 - flwr - DEBUG - ChannelConnectivity.IDLE
2025-05-24 07:08:02,687 - flwr - DEBUG - ChannelConnectivity.CONNECTING
2025-05-24 07:08:02,688 - flwr - DEBUG - ChannelConnectivity.READY
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1748070482.693080   40761 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
INFO :      
2025-05-24 07:08:04,594 - flwr - INFO - 
INFO :      Received: train message 5081cbba-4484-4ec7-a42f-8fb8a46d900d
2025-05-24 07:08:04,594 - flwr - INFO - Received: train message 5081cbba-4484-4ec7-a42f-8fb8a46d900d
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:08:04,594 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:08:04,620 - FL-Client-Ensemble - INFO - Round 1: Training base models with GA-Stacking
2025-05-24 07:08:04,620 - FL-Client-Ensemble - INFO - Generating equal initial weights for 7 base models
2025-05-24 07:08:04,620 - FL-Client-Ensemble - INFO - Generated equal initial weights: [0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
Generating meta-features...
I0000 00:00:1748070484.713998   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748070484.727395   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748070484.742071   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748070484.770298   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748070484.786246   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748070484.813937   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
Training base models...
Generating validation meta-features...
Running GA optimization...
Using provided initial weights: [0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
Gen 1/5 - best precision: 0.7500
Gen 2/5 - best precision: 0.7500
Gen 3/5 - best precision: 0.7500
Gen 4/5 - best precision: 0.7500
Gen 5/5 - best precision: 0.7500
Recall  : 0.8571428571428571
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      3790
           1       0.75      0.86      0.80         7

    accuracy                           1.00      3797
   macro avg       0.87      0.93      0.90      3797
weighted avg       1.00      1.00      1.00      3797

Saved 7 base models to models/client_client-0
2025-05-24 07:30:07,457 - FL-Client-Ensemble - INFO - Completed GA-Stacking with 7 base models

üéØ ROUND 1 TRAINING COMPLETED - DETAILED EVALUATION

üìä EVALUATING ON VALIDATION SET...

============================================================
  ROUND 1 - VALIDATION SET EVALUATION REPORT
============================================================

Dataset: Validation
Total Samples: 3797
Fraud Cases: 7 (0.18%)
Normal Cases: 3790 (99.82%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0096          -
 Accuracy 0.9992     99.92%
Precision 0.7500     75.00%
   Recall 0.8571     85.71%
 F1-Score 0.8000     80.00%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               3788                 1
 Predicted: 1 (Fraud)                  2                 6

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):     6 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  3788 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    2 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (85.7%) - Missing some fraud cases
  ‚úÖ GOOD precision (75.0%) - Low false alarm rate
============================================================


üß™ EVALUATING ON TEST SET...

============================================================
  ROUND 1 - TEST SET EVALUATION REPORT
============================================================

Dataset: Test
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0095          -
 Accuracy 0.9995     99.95%
Precision 0.8000     80.00%
   Recall 0.9231     92.31%
 F1-Score 0.8571     85.71%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7580                 1
 Predicted: 1 (Fraud)                  3                12

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    12 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7580 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    3 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚úÖ EXCELLENT recall (92.3%) - Catching most fraud cases!
  ‚úÖ GOOD precision (80.0%) - Low false alarm rate
============================================================

Recall  : 0.9230769230769231
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      7583
           1       0.80      0.92      0.86        13

    accuracy                           1.00      7596
   macro avg       0.90      0.96      0.93      7596
weighted avg       1.00      1.00      1.00      7596

2025-05-24 07:30:14,254 - federated.ipfs - INFO - Added file to IPFS with hash: QmTN8sdUkbqVTvdiEyhr6TiS1SVajSB8PukuYAV3GaVhPu
2025-05-24 07:30:14,254 - federated.ipfs - INFO - Added JSON data to IPFS with hash: QmTN8sdUkbqVTvdiEyhr6TiS1SVajSB8PukuYAV3GaVhPu
2025-05-24 07:30:14,255 - FL-Client-Ensemble - INFO - Stored client data in IPFS: QmTN8sdUkbqVTvdiEyhr6TiS1SVajSB8PukuYAV3GaVhPu
2025-05-24 07:30:14,258 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmTN8sdUkbqVTvdiEyhr6TiS1SVajSB8PukuYAV3GaVhPu
2025-05-24 07:30:14,258 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmTN8sdUkbqVTvdiEyhr6TiS1SVajSB8PukuYAV3GaVhPu
2025-05-24 07:30:14,259 - FL-Client-Ensemble - INFO - Verification - stored data contains keys: ['ensemble_weights', 'base_model_names', 'info', 'metrics']
2025-05-24 07:30:14,259 - FL-Client-Ensemble - INFO - Ensemble weights successfully stored, length: 7
INFO :      Sent reply
2025-05-24 07:30:14,266 - flwr - INFO - Sent reply
INFO :      
2025-05-24 07:35:47,074 - flwr - INFO - 
INFO :      Received: evaluate message 4bfabd6b-0a81-43c4-8c63-e9707652811b
2025-05-24 07:35:47,074 - flwr - INFO - Received: evaluate message 4bfabd6b-0a81-43c4-8c63-e9707652811b
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:35:47,076 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:35:47,109 - FL-Client-Ensemble - INFO - Starting evaluation for round 1
2025-05-24 07:35:47,109 - FL-Client-Ensemble - INFO - Using model from IPFS: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:47,109 - FL-Client-Ensemble - INFO - Attempting to evaluate using global ensemble model from IPFS
2025-05-24 07:35:47,111 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:47,112 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:47,112 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 07:35:47,112 - FL-Client-Ensemble - INFO - Evaluating global ensemble with 7 models
2025-05-24 07:35:47,112 - FL-Client-Ensemble - INFO - Ensemble weights: [0.11353686432546849, 0.077767604636423, 0.25233345362983056, 0.18292513379071473, 0.04582085104863068, 0.15054241869701332, 0.17707367387191913]
2025-05-24 07:35:47,112 - FL-Client-Ensemble - INFO - Loading base models from models/client_client-0
Loaded 7 base models from models/client_client-0
2025-05-24 07:35:47,158 - FL-Client-Ensemble - INFO - Successfully loaded 7 base models
2025-05-24 07:35:47,158 - FL-Client-Ensemble - INFO - Generating meta-features for global model evaluation

üåç GLOBAL MODEL EVALUATION - ROUND 1

============================================================
  ROUND 1 - TEST (GLOBAL ENSEMBLE) SET EVALUATION REPORT
============================================================

Dataset: Test (Global Ensemble)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0112          -
 Accuracy 0.9995     99.95%
Precision 0.8000     80.00%
   Recall 0.9231     92.31%
 F1-Score 0.8571     85.71%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7580                 1
 Predicted: 1 (Fraud)                  3                12

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    12 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7580 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    3 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚úÖ EXCELLENT recall (92.3%) - Catching most fraud cases!
  ‚úÖ GOOD precision (80.0%) - Low false alarm rate
============================================================

2025-05-24 07:35:49,889 - FL-Client-Ensemble - INFO - Our contribution: Score=8150.00, Reward=0.000000 ETH, Rank=0
2025-05-24 07:35:49,890 - FL-Client-Ensemble - INFO - Global model evaluation completed - Loss: 0.0112, Precision: 0.8000, Recall: 0.9231, F1: 0.8571
INFO :      Sent reply
2025-05-24 07:35:49,890 - flwr - INFO - Sent reply
INFO :      
2025-05-24 07:35:51,353 - flwr - INFO - 
INFO :      Received: train message 6066ccbc-c796-425b-85cf-c2945d08dc45
2025-05-24 07:35:51,353 - flwr - INFO - Received: train message 6066ccbc-c796-425b-85cf-c2945d08dc45
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:35:51,354 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:35:51,372 - FL-Client-Ensemble - INFO - Round 2: Fine-tuning with aggregated weights
2025-05-24 07:35:51,372 - FL-Client-Ensemble - INFO - Retrieving aggregated weights from IPFS hash: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:51,375 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:51,376 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:51,376 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 07:35:51,376 - FL-Client-Ensemble - INFO - Found ensemble weights in global model data: [0.11353686432546849, 0.077767604636423, 0.25233345362983056, 0.18292513379071473, 0.04582085104863068, 0.15054241869701332, 0.17707367387191913]
2025-05-24 07:35:51,376 - FL-Client-Ensemble - INFO - Found base model names in global model data: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 07:35:51,376 - FL-Client-Ensemble - INFO - Fine-tuning with base models: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 07:35:51,377 - FL-Client-Ensemble - INFO - Fine-tuning with aggregated weights: [0.11353686 0.0777676  0.25233345 0.18292513 0.04582085 0.15054242
 0.17707367]
Fine-tuning base models...
/home/cam/flwr/venv/lib/python3.8/site-packages/sklearn/ensemble/_forest.py:435: UserWarning: Warm-start fitting without increasing n_estimators does not fit new trees.
  warn(
Generating meta-features...
I0000 00:00:1748072440.294537   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748072440.315550   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748072440.337273   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748072440.348174   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
Generating validation meta-features...
DEBUG: meta_X_train shape: (90982, 7), type: <class 'numpy.ndarray'>
DEBUG: meta_X_val shape: (3797, 7), type: <class 'numpy.ndarray'>
DEBUG: About to call GA_weighted...
Running GA optimization...
Using provided aggregated weights: [0.11353686 0.0777676  0.25233345 0.18292513 0.04582085 0.15054242
 0.17707367]
Gen 1/5 - best precision: 0.7500
Gen 2/5 - best precision: 0.7500
Gen 3/5 - best precision: 0.7500
Gen 4/5 - best precision: 0.7500
Gen 5/5 - best precision: 0.7500
Recall  : 0.8571428571428571
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      3790
           1       0.75      0.86      0.80         7

    accuracy                           1.00      3797
   macro avg       0.87      0.93      0.90      3797
weighted avg       1.00      1.00      1.00      3797

2025-05-24 07:54:47,205 - FL-Client-Ensemble - INFO - Completed fine-tuning with 7 base models
2025-05-24 07:54:47,206 - FL-Client-Ensemble - INFO - Updated ensemble weights: [0.05329673828126148, 0.12692306470150733, 0.2657307741058584, 1.0907891279797207e-06, 0.22490259393689332, 0.22459411657996056, 0.10455162160539096]

üìà ROUND 2 FINE-TUNING COMPLETED

üìä EVALUATING ON VALIDATION SET AFTER FINE-TUNING...

============================================================
  ROUND 2 - VALIDATION (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Validation (After Fine-tuning)
Total Samples: 3797
Fraud Cases: 7 (0.18%)
Normal Cases: 3790 (99.82%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0081          -
 Accuracy 0.9992     99.92%
Precision 0.7500     75.00%
   Recall 0.8571     85.71%
 F1-Score 0.8000     80.00%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               3788                 1
 Predicted: 1 (Fraud)                  2                 6

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):     6 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  3788 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    2 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (85.7%) - Missing some fraud cases
  ‚úÖ GOOD precision (75.0%) - Low false alarm rate
============================================================


üß™ EVALUATING ON TEST SET AFTER FINE-TUNING...

============================================================
  ROUND 2 - TEST (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Test (After Fine-tuning)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0082          -
 Accuracy 0.9995     99.95%
Precision 0.8000     80.00%
   Recall 0.9231     92.31%
 F1-Score 0.8571     85.71%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7580                 1
 Predicted: 1 (Fraud)                  3                12

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    12 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7580 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    3 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚úÖ EXCELLENT recall (92.3%) - Catching most fraud cases!
  ‚úÖ GOOD precision (80.0%) - Low false alarm rate
============================================================

Recall  : 0.9230769230769231
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      7583
           1       0.80      0.92      0.86        13

    accuracy                           1.00      7596
   macro avg       0.90      0.96      0.93      7596
weighted avg       1.00      1.00      1.00      7596

2025-05-24 07:54:59,924 - federated.ipfs - INFO - Added file to IPFS with hash: QmYFhEDD8x2WgV2EexAc5T9zbybf2RNBhTD3VidUCVsW15
2025-05-24 07:54:59,925 - federated.ipfs - INFO - Added JSON data to IPFS with hash: QmYFhEDD8x2WgV2EexAc5T9zbybf2RNBhTD3VidUCVsW15
2025-05-24 07:54:59,925 - FL-Client-Ensemble - INFO - Stored client data in IPFS: QmYFhEDD8x2WgV2EexAc5T9zbybf2RNBhTD3VidUCVsW15
2025-05-24 07:54:59,928 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmYFhEDD8x2WgV2EexAc5T9zbybf2RNBhTD3VidUCVsW15
2025-05-24 07:54:59,928 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmYFhEDD8x2WgV2EexAc5T9zbybf2RNBhTD3VidUCVsW15
2025-05-24 07:54:59,928 - FL-Client-Ensemble - INFO - Verification - stored data contains keys: ['ensemble_weights', 'base_model_names', 'info', 'metrics']
2025-05-24 07:54:59,928 - FL-Client-Ensemble - INFO - Ensemble weights successfully stored, length: 7
INFO :      Sent reply
2025-05-24 07:54:59,935 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:02:14,947 - flwr - INFO - 
INFO :      Received: evaluate message 13c82328-a9c2-4f73-921e-663606af3a58
2025-05-24 08:02:14,948 - flwr - INFO - Received: evaluate message 13c82328-a9c2-4f73-921e-663606af3a58
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:02:14,948 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:02:14,973 - FL-Client-Ensemble - INFO - Starting evaluation for round 2
2025-05-24 08:02:14,974 - FL-Client-Ensemble - INFO - Using model from IPFS: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:14,975 - FL-Client-Ensemble - INFO - Attempting to evaluate using global ensemble model from IPFS
2025-05-24 08:02:14,978 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:14,979 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:14,979 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:02:14,979 - FL-Client-Ensemble - INFO - Evaluating global ensemble with 7 models
2025-05-24 08:02:14,979 - FL-Client-Ensemble - INFO - Ensemble weights: [0.09834125984957352, 0.0975457282789974, 0.25501165581010377, 0.07666750850679883, 0.15003903285522482, 0.18337960133467382, 0.13901521336462788]
2025-05-24 08:02:14,980 - FL-Client-Ensemble - INFO - Generating meta-features for global model evaluation

üåç GLOBAL MODEL EVALUATION - ROUND 2

============================================================
  ROUND 2 - TEST (GLOBAL ENSEMBLE) SET EVALUATION REPORT
============================================================

Dataset: Test (Global Ensemble)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0105          -
 Accuracy 0.9995     99.95%
Precision 0.8000     80.00%
   Recall 0.9231     92.31%
 F1-Score 0.8571     85.71%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7580                 1
 Predicted: 1 (Fraud)                  3                12

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    12 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7580 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    3 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚úÖ EXCELLENT recall (92.3%) - Catching most fraud cases!
  ‚úÖ GOOD precision (80.0%) - Low false alarm rate
============================================================

2025-05-24 08:02:17,733 - FL-Client-Ensemble - INFO - Our contribution: Score=8150.00, Reward=0.000000 ETH, Rank=0
2025-05-24 08:02:17,733 - FL-Client-Ensemble - INFO - Global model evaluation completed - Loss: 0.0105, Precision: 0.8000, Recall: 0.9231, F1: 0.8571
INFO :      Sent reply
2025-05-24 08:02:17,734 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:02:18,902 - flwr - INFO - 
INFO :      Received: train message dec361e9-9645-44c6-816d-822ecccbefc5
2025-05-24 08:02:18,902 - flwr - INFO - Received: train message dec361e9-9645-44c6-816d-822ecccbefc5
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:02:18,902 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:02:18,921 - FL-Client-Ensemble - INFO - Round 3: Fine-tuning with aggregated weights
2025-05-24 08:02:18,921 - FL-Client-Ensemble - INFO - Retrieving aggregated weights from IPFS hash: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:18,924 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:18,924 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:18,924 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:02:18,924 - FL-Client-Ensemble - INFO - Found ensemble weights in global model data: [0.09834125984957352, 0.0975457282789974, 0.25501165581010377, 0.07666750850679883, 0.15003903285522482, 0.18337960133467382, 0.13901521336462788]
2025-05-24 08:02:18,924 - FL-Client-Ensemble - INFO - Found base model names in global model data: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:02:18,924 - FL-Client-Ensemble - INFO - Fine-tuning with base models: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:02:18,924 - FL-Client-Ensemble - INFO - Fine-tuning with aggregated weights: [0.09834126 0.09754573 0.25501166 0.07666751 0.15003903 0.1833796
 0.13901521]
Fine-tuning base models...
/home/cam/flwr/venv/lib/python3.8/site-packages/sklearn/ensemble/_forest.py:435: UserWarning: Warm-start fitting without increasing n_estimators does not fit new trees.
  warn(
Generating meta-features...
I0000 00:00:1748074047.815344   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748074047.831212   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748074047.990083   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748074048.007399   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
Generating validation meta-features...
DEBUG: meta_X_train shape: (90982, 7), type: <class 'numpy.ndarray'>
DEBUG: meta_X_val shape: (3797, 7), type: <class 'numpy.ndarray'>
DEBUG: About to call GA_weighted...
Running GA optimization...
Using provided aggregated weights: [0.09834126 0.09754573 0.25501166 0.07666751 0.15003903 0.1833796
 0.13901521]
Gen 1/5 - best precision: 0.7500
Gen 2/5 - best precision: 0.7500
Gen 3/5 - best precision: 0.7500
Gen 4/5 - best precision: 0.7500
Gen 5/5 - best precision: 0.7500
Recall  : 0.8571428571428571
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      3790
           1       0.75      0.86      0.80         7

    accuracy                           1.00      3797
   macro avg       0.87      0.93      0.90      3797
weighted avg       1.00      1.00      1.00      3797

2025-05-24 08:20:38,345 - FL-Client-Ensemble - INFO - Completed fine-tuning with 7 base models
2025-05-24 08:20:38,354 - FL-Client-Ensemble - INFO - Updated ensemble weights: [0.11100820310514894, 0.06408864115024338, 0.22247125110136035, 0.08928425891385164, 0.16826291183297676, 0.1899121661778972, 0.1549725677185217]

üìà ROUND 3 FINE-TUNING COMPLETED

üìä EVALUATING ON VALIDATION SET AFTER FINE-TUNING...

============================================================
  ROUND 3 - VALIDATION (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Validation (After Fine-tuning)
Total Samples: 3797
Fraud Cases: 7 (0.18%)
Normal Cases: 3790 (99.82%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0111          -
 Accuracy 0.9992     99.92%
Precision 0.7500     75.00%
   Recall 0.8571     85.71%
 F1-Score 0.8000     80.00%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               3788                 1
 Predicted: 1 (Fraud)                  2                 6

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):     6 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  3788 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    2 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (85.7%) - Missing some fraud cases
  ‚úÖ GOOD precision (75.0%) - Low false alarm rate
============================================================


üß™ EVALUATING ON TEST SET AFTER FINE-TUNING...

============================================================
  ROUND 3 - TEST (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Test (After Fine-tuning)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0108          -
 Accuracy 0.9995     99.95%
Precision 0.8000     80.00%
   Recall 0.9231     92.31%
 F1-Score 0.8571     85.71%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7580                 1
 Predicted: 1 (Fraud)                  3                12

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    12 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7580 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    3 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚úÖ EXCELLENT recall (92.3%) - Catching most fraud cases!
  ‚úÖ GOOD precision (80.0%) - Low false alarm rate
============================================================

Recall  : 0.9230769230769231
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      7583
           1       0.80      0.92      0.86        13

    accuracy                           1.00      7596
   macro avg       0.90      0.96      0.93      7596
weighted avg       1.00      1.00      1.00      7596

2025-05-24 08:20:50,211 - federated.ipfs - INFO - Added file to IPFS with hash: Qmab1FS9aJ5cDJuT35P5UEroFjDS2LyY9BsvXgLtNEwCe2
2025-05-24 08:20:50,211 - federated.ipfs - INFO - Added JSON data to IPFS with hash: Qmab1FS9aJ5cDJuT35P5UEroFjDS2LyY9BsvXgLtNEwCe2
2025-05-24 08:20:50,211 - FL-Client-Ensemble - INFO - Stored client data in IPFS: Qmab1FS9aJ5cDJuT35P5UEroFjDS2LyY9BsvXgLtNEwCe2
2025-05-24 08:20:50,224 - federated.ipfs - INFO - Retrieved file from IPFS with hash: Qmab1FS9aJ5cDJuT35P5UEroFjDS2LyY9BsvXgLtNEwCe2
2025-05-24 08:20:50,224 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: Qmab1FS9aJ5cDJuT35P5UEroFjDS2LyY9BsvXgLtNEwCe2
2025-05-24 08:20:50,224 - FL-Client-Ensemble - INFO - Verification - stored data contains keys: ['ensemble_weights', 'base_model_names', 'info', 'metrics']
2025-05-24 08:20:50,224 - FL-Client-Ensemble - INFO - Ensemble weights successfully stored, length: 7
INFO :      Sent reply
2025-05-24 08:20:50,239 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:28:40,137 - flwr - INFO - 
INFO :      Received: evaluate message da3b1a15-c96e-4a6c-929d-87294af26b4b
2025-05-24 08:28:40,137 - flwr - INFO - Received: evaluate message da3b1a15-c96e-4a6c-929d-87294af26b4b
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:28:40,138 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:28:40,168 - FL-Client-Ensemble - INFO - Starting evaluation for round 3
2025-05-24 08:28:40,168 - FL-Client-Ensemble - INFO - Using model from IPFS: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:40,168 - FL-Client-Ensemble - INFO - Attempting to evaluate using global ensemble model from IPFS
2025-05-24 08:28:40,172 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:40,172 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:40,172 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:28:40,172 - FL-Client-Ensemble - INFO - Evaluating global ensemble with 7 models
2025-05-24 08:28:40,173 - FL-Client-Ensemble - INFO - Ensemble weights: [0.11409526877677836, 0.07301107187303241, 0.19638792708073263, 0.10042878972416125, 0.12176672271401215, 0.19787623813249647, 0.19643398169878667]
2025-05-24 08:28:40,173 - FL-Client-Ensemble - INFO - Generating meta-features for global model evaluation

üåç GLOBAL MODEL EVALUATION - ROUND 3

============================================================
  ROUND 3 - TEST (GLOBAL ENSEMBLE) SET EVALUATION REPORT
============================================================

Dataset: Test (Global Ensemble)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0110          -
 Accuracy 0.9995     99.95%
Precision 0.8000     80.00%
   Recall 0.9231     92.31%
 F1-Score 0.8571     85.71%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7580                 1
 Predicted: 1 (Fraud)                  3                12

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    12 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7580 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    3 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚úÖ EXCELLENT recall (92.3%) - Catching most fraud cases!
  ‚úÖ GOOD precision (80.0%) - Low false alarm rate
============================================================

2025-05-24 08:28:43,114 - FL-Client-Ensemble - INFO - Our contribution: Score=8150.00, Reward=0.000000 ETH, Rank=0
2025-05-24 08:28:43,114 - FL-Client-Ensemble - INFO - Global model evaluation completed - Loss: 0.0110, Precision: 0.8000, Recall: 0.9231, F1: 0.8571
INFO :      Sent reply
2025-05-24 08:28:43,114 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:28:44,351 - flwr - INFO - 
INFO :      Received: train message 34ac3bf9-713c-4a02-8172-f62b71f66856
2025-05-24 08:28:44,351 - flwr - INFO - Received: train message 34ac3bf9-713c-4a02-8172-f62b71f66856
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:28:44,351 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:28:44,361 - FL-Client-Ensemble - INFO - Round 4: Fine-tuning with aggregated weights
2025-05-24 08:28:44,361 - FL-Client-Ensemble - INFO - Retrieving aggregated weights from IPFS hash: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:44,363 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:44,363 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:44,363 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:28:44,363 - FL-Client-Ensemble - INFO - Found ensemble weights in global model data: [0.11409526877677836, 0.07301107187303241, 0.19638792708073263, 0.10042878972416125, 0.12176672271401215, 0.19787623813249647, 0.19643398169878667]
2025-05-24 08:28:44,363 - FL-Client-Ensemble - INFO - Found base model names in global model data: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:28:44,363 - FL-Client-Ensemble - INFO - Fine-tuning with base models: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:28:44,363 - FL-Client-Ensemble - INFO - Fine-tuning with aggregated weights: [0.11409527 0.07301107 0.19638793 0.10042879 0.12176672 0.19787624
 0.19643398]
Fine-tuning base models...
/home/cam/flwr/venv/lib/python3.8/site-packages/sklearn/ensemble/_forest.py:435: UserWarning: Warm-start fitting without increasing n_estimators does not fit new trees.
  warn(
Generating meta-features...
I0000 00:00:1748075633.389998   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748075633.412500   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748075633.430114   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748075633.450043   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
Generating validation meta-features...
DEBUG: meta_X_train shape: (90982, 7), type: <class 'numpy.ndarray'>
DEBUG: meta_X_val shape: (3797, 7), type: <class 'numpy.ndarray'>
DEBUG: About to call GA_weighted...
Running GA optimization...
Using provided aggregated weights: [0.11409527 0.07301107 0.19638793 0.10042879 0.12176672 0.19787624
 0.19643398]
Gen 1/5 - best precision: 0.7500
Gen 2/5 - best precision: 0.7500
Gen 3/5 - best precision: 0.7500
Gen 4/5 - best precision: 0.7500
Gen 5/5 - best precision: 0.7500
Recall  : 0.8571428571428571
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      3790
           1       0.75      0.86      0.80         7

    accuracy                           1.00      3797
   macro avg       0.87      0.93      0.90      3797
weighted avg       1.00      1.00      1.00      3797

2025-05-24 08:47:55,816 - FL-Client-Ensemble - INFO - Completed fine-tuning with 7 base models
2025-05-24 08:47:55,830 - FL-Client-Ensemble - INFO - Updated ensemble weights: [0.04947542908495316, 0.17437586091864488, 0.1621406665859438, 0.06338244987783759, 0.17633736381909978, 0.24443276240776676, 0.129855467305754]

üìà ROUND 4 FINE-TUNING COMPLETED

üìä EVALUATING ON VALIDATION SET AFTER FINE-TUNING...

============================================================
  ROUND 4 - VALIDATION (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Validation (After Fine-tuning)
Total Samples: 3797
Fraud Cases: 7 (0.18%)
Normal Cases: 3790 (99.82%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0082          -
 Accuracy 0.9992     99.92%
Precision 0.7500     75.00%
   Recall 0.8571     85.71%
 F1-Score 0.8000     80.00%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               3788                 1
 Predicted: 1 (Fraud)                  2                 6

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):     6 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  3788 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    2 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (85.7%) - Missing some fraud cases
  ‚úÖ GOOD precision (75.0%) - Low false alarm rate
============================================================


üß™ EVALUATING ON TEST SET AFTER FINE-TUNING...

============================================================
  ROUND 4 - TEST (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Test (After Fine-tuning)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0085          -
 Accuracy 0.9995     99.95%
Precision 0.8000     80.00%
   Recall 0.9231     92.31%
 F1-Score 0.8571     85.71%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7580                 1
 Predicted: 1 (Fraud)                  3                12

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    12 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7580 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    3 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚úÖ EXCELLENT recall (92.3%) - Catching most fraud cases!
  ‚úÖ GOOD precision (80.0%) - Low false alarm rate
============================================================

Recall  : 0.9230769230769231
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      7583
           1       0.80      0.92      0.86        13

    accuracy                           1.00      7596
   macro avg       0.90      0.96      0.93      7596
weighted avg       1.00      1.00      1.00      7596

2025-05-24 08:48:07,076 - federated.ipfs - INFO - Added file to IPFS with hash: QmNRTS1dEFmHKmrQPtSk1cHTksruhzZShwKwgWKiY3KC8p
2025-05-24 08:48:07,077 - federated.ipfs - INFO - Added JSON data to IPFS with hash: QmNRTS1dEFmHKmrQPtSk1cHTksruhzZShwKwgWKiY3KC8p
2025-05-24 08:48:07,077 - FL-Client-Ensemble - INFO - Stored client data in IPFS: QmNRTS1dEFmHKmrQPtSk1cHTksruhzZShwKwgWKiY3KC8p
2025-05-24 08:48:07,081 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmNRTS1dEFmHKmrQPtSk1cHTksruhzZShwKwgWKiY3KC8p
2025-05-24 08:48:07,082 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmNRTS1dEFmHKmrQPtSk1cHTksruhzZShwKwgWKiY3KC8p
2025-05-24 08:48:07,082 - FL-Client-Ensemble - INFO - Verification - stored data contains keys: ['ensemble_weights', 'base_model_names', 'info', 'metrics']
2025-05-24 08:48:07,082 - FL-Client-Ensemble - INFO - Ensemble weights successfully stored, length: 7
INFO :      Sent reply
2025-05-24 08:48:07,083 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:54:40,488 - flwr - INFO - 
INFO :      Received: evaluate message e465afbf-7bd5-44e5-a27b-7b47ae4e8100
2025-05-24 08:54:40,489 - flwr - INFO - Received: evaluate message e465afbf-7bd5-44e5-a27b-7b47ae4e8100
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:54:40,490 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:54:40,520 - FL-Client-Ensemble - INFO - Starting evaluation for round 4
2025-05-24 08:54:40,520 - FL-Client-Ensemble - INFO - Using model from IPFS: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:40,520 - FL-Client-Ensemble - INFO - Attempting to evaluate using global ensemble model from IPFS
2025-05-24 08:54:40,527 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:40,527 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:40,527 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:54:40,528 - FL-Client-Ensemble - INFO - Evaluating global ensemble with 7 models
2025-05-24 08:54:40,528 - FL-Client-Ensemble - INFO - Ensemble weights: [0.08439130960966272, 0.13613491606341205, 0.22378192184430135, 0.07694620381027872, 0.15787929673498036, 0.14008673053432036, 0.1807796214030445]
2025-05-24 08:54:40,528 - FL-Client-Ensemble - INFO - Generating meta-features for global model evaluation

üåç GLOBAL MODEL EVALUATION - ROUND 4

============================================================
  ROUND 4 - TEST (GLOBAL ENSEMBLE) SET EVALUATION REPORT
============================================================

Dataset: Test (Global Ensemble)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0102          -
 Accuracy 0.9995     99.95%
Precision 0.8000     80.00%
   Recall 0.9231     92.31%
 F1-Score 0.8571     85.71%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7580                 1
 Predicted: 1 (Fraud)                  3                12

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    12 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7580 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    3 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚úÖ EXCELLENT recall (92.3%) - Catching most fraud cases!
  ‚úÖ GOOD precision (80.0%) - Low false alarm rate
============================================================

2025-05-24 08:54:43,408 - FL-Client-Ensemble - INFO - Our contribution: Score=8150.00, Reward=0.000000 ETH, Rank=0
2025-05-24 08:54:43,409 - FL-Client-Ensemble - INFO - Global model evaluation completed - Loss: 0.0102, Precision: 0.8000, Recall: 0.9231, F1: 0.8571
INFO :      Sent reply
2025-05-24 08:54:43,409 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:54:44,548 - flwr - INFO - 
INFO :      Received: train message b8257f07-e2ff-4a69-ade7-a579d82ca69d
2025-05-24 08:54:44,549 - flwr - INFO - Received: train message b8257f07-e2ff-4a69-ade7-a579d82ca69d
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:54:44,550 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:54:44,565 - FL-Client-Ensemble - INFO - Round 5: Fine-tuning with aggregated weights
2025-05-24 08:54:44,565 - FL-Client-Ensemble - INFO - Retrieving aggregated weights from IPFS hash: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:44,570 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:44,571 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:44,571 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:54:44,572 - FL-Client-Ensemble - INFO - Found ensemble weights in global model data: [0.08439130960966272, 0.13613491606341205, 0.22378192184430135, 0.07694620381027872, 0.15787929673498036, 0.14008673053432036, 0.1807796214030445]
2025-05-24 08:54:44,572 - FL-Client-Ensemble - INFO - Found base model names in global model data: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:54:44,572 - FL-Client-Ensemble - INFO - Fine-tuning with base models: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:54:44,573 - FL-Client-Ensemble - INFO - Fine-tuning with aggregated weights: [0.08439131 0.13613492 0.22378192 0.0769462  0.1578793  0.14008673
 0.18077962]
Fine-tuning base models...
/home/cam/flwr/venv/lib/python3.8/site-packages/sklearn/ensemble/_forest.py:435: UserWarning: Warm-start fitting without increasing n_estimators does not fit new trees.
  warn(
Generating meta-features...
I0000 00:00:1748077162.291541   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748077162.309878   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748077162.326412   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748077162.345938   40732 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
Generating validation meta-features...
DEBUG: meta_X_train shape: (90982, 7), type: <class 'numpy.ndarray'>
DEBUG: meta_X_val shape: (3797, 7), type: <class 'numpy.ndarray'>
DEBUG: About to call GA_weighted...
Running GA optimization...
Using provided aggregated weights: [0.08439131 0.13613492 0.22378192 0.0769462  0.1578793  0.14008673
 0.18077962]
Gen 1/5 - best precision: 0.7500
Gen 2/5 - best precision: 0.7500
Gen 3/5 - best precision: 0.7500
Gen 4/5 - best precision: 0.7500
Gen 5/5 - best precision: 0.7500
Recall  : 0.8571428571428571
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      3790
           1       0.75      0.86      0.80         7

    accuracy                           1.00      3797
   macro avg       0.87      0.93      0.90      3797
weighted avg       1.00      1.00      1.00      3797

2025-05-24 09:13:15,725 - FL-Client-Ensemble - INFO - Completed fine-tuning with 7 base models
2025-05-24 09:13:15,725 - FL-Client-Ensemble - INFO - Updated ensemble weights: [0.0622921211854403, 0.11584506192665125, 0.19824288258020628, 0.06246965460658607, 0.31067387526289825, 0.12857202309093446, 0.12190438134728337]

üìà ROUND 5 FINE-TUNING COMPLETED

üìä EVALUATING ON VALIDATION SET AFTER FINE-TUNING...

============================================================
  ROUND 5 - VALIDATION (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Validation (After Fine-tuning)
Total Samples: 3797
Fraud Cases: 7 (0.18%)
Normal Cases: 3790 (99.82%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0087          -
 Accuracy 0.9992     99.92%
Precision 0.7500     75.00%
   Recall 0.8571     85.71%
 F1-Score 0.8000     80.00%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               3788                 1
 Predicted: 1 (Fraud)                  2                 6

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):     6 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  3788 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    2 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (85.7%) - Missing some fraud cases
  ‚úÖ GOOD precision (75.0%) - Low false alarm rate
============================================================


üß™ EVALUATING ON TEST SET AFTER FINE-TUNING...

============================================================
  ROUND 5 - TEST (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Test (After Fine-tuning)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0086          -
 Accuracy 0.9995     99.95%
Precision 0.8000     80.00%
   Recall 0.9231     92.31%
 F1-Score 0.8571     85.71%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7580                 1
 Predicted: 1 (Fraud)                  3                12

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    12 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7580 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    3 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚úÖ EXCELLENT recall (92.3%) - Catching most fraud cases!
  ‚úÖ GOOD precision (80.0%) - Low false alarm rate
============================================================

Recall  : 0.9230769230769231
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      7583
           1       0.80      0.92      0.86        13

    accuracy                           1.00      7596
   macro avg       0.90      0.96      0.93      7596
weighted avg       1.00      1.00      1.00      7596

2025-05-24 09:13:27,570 - federated.ipfs - INFO - Added file to IPFS with hash: QmQ9X9LkDQywnog1HZokyoeFDUjroZst9AcJZW4CbWjb7o
2025-05-24 09:13:27,570 - federated.ipfs - INFO - Added JSON data to IPFS with hash: QmQ9X9LkDQywnog1HZokyoeFDUjroZst9AcJZW4CbWjb7o
2025-05-24 09:13:27,570 - FL-Client-Ensemble - INFO - Stored client data in IPFS: QmQ9X9LkDQywnog1HZokyoeFDUjroZst9AcJZW4CbWjb7o
2025-05-24 09:13:27,573 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmQ9X9LkDQywnog1HZokyoeFDUjroZst9AcJZW4CbWjb7o
2025-05-24 09:13:27,573 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmQ9X9LkDQywnog1HZokyoeFDUjroZst9AcJZW4CbWjb7o
2025-05-24 09:13:27,573 - FL-Client-Ensemble - INFO - Verification - stored data contains keys: ['ensemble_weights', 'base_model_names', 'info', 'metrics']
2025-05-24 09:13:27,573 - FL-Client-Ensemble - INFO - Ensemble weights successfully stored, length: 7
INFO :      Sent reply
2025-05-24 09:13:27,575 - flwr - INFO - Sent reply
INFO :      
2025-05-24 09:21:22,164 - flwr - INFO - 
INFO :      Received: evaluate message ebcaea7d-69b3-46cb-a1c8-16128900fc82
2025-05-24 09:21:22,165 - flwr - INFO - Received: evaluate message ebcaea7d-69b3-46cb-a1c8-16128900fc82
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 09:21:22,165 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 09:21:22,185 - FL-Client-Ensemble - INFO - Starting evaluation for round 5
2025-05-24 09:21:22,185 - FL-Client-Ensemble - INFO - Using model from IPFS: QmdvEfnx4ff8aHMQp6N5E3zfeGaF6v7M6gpNCgDvGmfZtU
2025-05-24 09:21:22,185 - FL-Client-Ensemble - INFO - Attempting to evaluate using global ensemble model from IPFS
2025-05-24 09:21:22,188 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmdvEfnx4ff8aHMQp6N5E3zfeGaF6v7M6gpNCgDvGmfZtU
2025-05-24 09:21:22,188 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmdvEfnx4ff8aHMQp6N5E3zfeGaF6v7M6gpNCgDvGmfZtU
2025-05-24 09:21:22,188 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 09:21:22,188 - FL-Client-Ensemble - INFO - Evaluating global ensemble with 7 models
2025-05-24 09:21:22,189 - FL-Client-Ensemble - INFO - Ensemble weights: [0.07438168502614205, 0.10082179011437978, 0.24497577227480016, 0.09425212480387338, 0.18172655867353302, 0.17216271413270223, 0.1316793549745694]
2025-05-24 09:21:22,189 - FL-Client-Ensemble - INFO - Generating meta-features for global model evaluation

üåç GLOBAL MODEL EVALUATION - ROUND 5

============================================================
  ROUND 5 - TEST (GLOBAL ENSEMBLE) SET EVALUATION REPORT
============================================================

Dataset: Test (Global Ensemble)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0092          -
 Accuracy 0.9995     99.95%
Precision 0.8000     80.00%
   Recall 0.9231     92.31%
 F1-Score 0.8571     85.71%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7580                 1
 Predicted: 1 (Fraud)                  3                12

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    12 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7580 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    3 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚úÖ EXCELLENT recall (92.3%) - Catching most fraud cases!
  ‚úÖ GOOD precision (80.0%) - Low false alarm rate
============================================================

2025-05-24 09:21:25,329 - FL-Client-Ensemble - INFO - Our contribution: Score=8150.00, Reward=0.000000 ETH, Rank=0
2025-05-24 09:21:25,329 - FL-Client-Ensemble - INFO - Global model evaluation completed - Loss: 0.0092, Precision: 0.8000, Recall: 0.9231, F1: 0.8571
INFO :      Sent reply
2025-05-24 09:21:25,329 - flwr - INFO - Sent reply
INFO :      
2025-05-24 09:21:26,757 - flwr - INFO - 
INFO :      Received: reconnect message a1eb5f2f-7958-4064-a089-598b78b6dfff
2025-05-24 09:21:26,757 - flwr - INFO - Received: reconnect message a1eb5f2f-7958-4064-a089-598b78b6dfff
2025-05-24 09:21:26,817 - flwr - DEBUG - gRPC channel closed
INFO :      Disconnect and shut down
2025-05-24 09:21:26,822 - flwr - INFO - Disconnect and shut down
2025-05-24 09:21:26,850 - FL-Client-Ensemble - INFO - Saved metrics history to metrics/client-0/metrics_history.json
2025-05-24 09:21:26,856 - FL-Client-Ensemble - INFO - Client client-0 completed federated learning with GA-Stacking