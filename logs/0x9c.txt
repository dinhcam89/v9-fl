(venv) cam@client2:~/flwr/v5-fl$ python client.py   --ipfs-url http://192.168.80.180:5001/api/v0   --server-address 192.168.80.180:8088   --ga-generations 3   --ga-population-size 10   --contract-address 0x760adD85eF476BdFd733B2Bf1c37A75A9CAa0e97   --wallet-address 0x9c4Ec6537bF4d916B71008003Fb1311B7C157C4f   --csv-file=data/clients/client_1.csv   --client-id client-1
2025-05-24 07:08:03,810 - federated.ipfs - INFO - Connected to IPFS node version: 0.34.1
2025-05-24 07:08:03,810 - FL-Client-Ensemble - INFO - Initialized IPFS connector: http://192.168.80.180:5001/api/v0
Using Ganache account: 0xb6845ba34Fc592266921419ef65b9b4D943e2797
Contract loaded at address: 0x760adD85eF476BdFd733B2Bf1c37A75A9CAa0e97
2025-05-24 07:08:03,847 - FL-Client-Ensemble - INFO - Initialized blockchain connector: http://192.168.80.1:7545
2025-05-24 07:08:03,847 - FL-Client-Ensemble - INFO - Using contract at: 0x760adD85eF476BdFd733B2Bf1c37A75A9CAa0e97
2025-05-24 07:08:03,847 - FL-Client-Ensemble - INFO - Using dataset file: data/clients/client_1.csv
2025-05-24 07:08:04,380 - FL-Client-Ensemble - INFO - Successfully loaded dataset with 56962 samples and 31 features
2025-05-24 07:08:04,381 - FL-Client-Ensemble - INFO - Target column: Class, Class distribution: {0: 56869, 1: 93}
2025-05-24 07:08:04,381 - FL-Client-Ensemble - INFO - DataFrame columns: ['Time', 'V1', 'V2', 'V3', 'V4', 'V5', 'V6', 'V7', 'V8', 'V9', 'V10', 'V11', 'V12', 'V13', 'V14', 'V15', 'V16', 'V17', 'V18', 'V19', 'V20', 'V21', 'V22', 'V23', 'V24', 'V25', 'V26', 'V27', 'V28', 'Amount', 'Class']
2025-05-24 07:08:04,388 - FL-Client-Ensemble - INFO - Features shape: (56962, 22), Target shape: (56962,)
2025-05-24 07:08:04,450 - FL-Client-Ensemble - INFO - Data info before SMOTE:
2025-05-24 07:08:04,450 - FL-Client-Ensemble - INFO - [BEFORE] Train: (45569, 22), Validation: (3797, 22), Test: (7596, 22)
2025-05-24 07:08:04,518 - FL-Client-Ensemble - INFO - SMOTE applied. New training shape: (90990, 22)
2025-05-24 07:08:04,519 - FL-Client-Ensemble - INFO - Preprocessing complete.
2025-05-24 07:08:04,519 - FL-Client-Ensemble - INFO - Train: (90990, 22), Validation: (3797, 22), Test: (7596, 22)
2025-05-24 07:08:04,519 - FL-Client-Ensemble - INFO - Data preprocessing complete:
2025-05-24 07:08:04,520 - FL-Client-Ensemble - INFO - - Training set: 90990 samples
2025-05-24 07:08:04,520 - FL-Client-Ensemble - INFO - - Validation set: 3797 samples
2025-05-24 07:08:04,520 - FL-Client-Ensemble - INFO - - Test set: 7596 samples
2025-05-24 07:08:04,520 - FL-Client-Ensemble - INFO - Initialized client-1 with GA-Stacking pipeline
2025-05-24 07:08:04,520 - FL-Client-Ensemble - INFO - IPFS node: http://192.168.80.180:5001/api/v0
2025-05-24 07:08:04,544 - FL-Client-Ensemble - INFO - Client 0x9c4Ec6537bF4d916B71008003Fb1311B7C157C4f is authorized on the blockchain ‚úÖ
2025-05-24 07:08:04,559 - flwr - DEBUG - Opened insecure gRPC connection (no certificates were passed)
2025-05-24 07:08:04,581 - flwr - DEBUG - ChannelConnectivity.IDLE
2025-05-24 07:08:04,582 - flwr - DEBUG - ChannelConnectivity.CONNECTING
2025-05-24 07:08:04,589 - flwr - DEBUG - ChannelConnectivity.READY
INFO :      
2025-05-24 07:08:04,594 - flwr - INFO - 
INFO :      Received: train message 1c5e01a2-6d9d-489b-b94f-998d31340908
2025-05-24 07:08:04,594 - flwr - INFO - Received: train message 1c5e01a2-6d9d-489b-b94f-998d31340908
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:08:04,595 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:08:04,618 - FL-Client-Ensemble - INFO - Round 1: Training base models with GA-Stacking
2025-05-24 07:08:04,619 - FL-Client-Ensemble - INFO - Generating equal initial weights for 7 base models
2025-05-24 07:08:04,619 - FL-Client-Ensemble - INFO - Generated equal initial weights: [0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
Generating meta-features...
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1748070484.715440   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748070484.728417   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748070484.738114   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748070484.751856   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748070484.766348   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748070484.790176   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
Training base models...
Generating validation meta-features...
Running GA optimization...
Using provided initial weights: [0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
Gen 1/5 - best precision: 1.0000
Gen 2/5 - best precision: 1.0000
Gen 3/5 - best precision: 1.0000
Gen 4/5 - best precision: 1.0000
Gen 5/5 - best precision: 1.0000
Recall  : 0.8333333333333334
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      3791
           1       1.00      0.83      0.91         6

    accuracy                           1.00      3797
   macro avg       1.00      0.92      0.95      3797
weighted avg       1.00      1.00      1.00      3797

Saved 7 base models to models/client_client-1
2025-05-24 07:35:33,817 - FL-Client-Ensemble - INFO - Completed GA-Stacking with 7 base models

üéØ ROUND 1 TRAINING COMPLETED - DETAILED EVALUATION

üìä EVALUATING ON VALIDATION SET...

============================================================
  ROUND 1 - VALIDATION SET EVALUATION REPORT
============================================================

Dataset: Validation
Total Samples: 3797
Fraud Cases: 6 (0.16%)
Normal Cases: 3791 (99.84%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0139          -
 Accuracy 0.9997     99.97%
Precision 1.0000    100.00%
   Recall 0.8333     83.33%
 F1-Score 0.9091     90.91%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               3791                 1
 Predicted: 1 (Fraud)                  0                 5

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):     5 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  3791 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    0 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (83.3%) - Missing some fraud cases
  ‚úÖ GOOD precision (100.0%) - Low false alarm rate
============================================================


üß™ EVALUATING ON TEST SET...

============================================================
  ROUND 1 - TEST SET EVALUATION REPORT
============================================================

Dataset: Test
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0160          -
 Accuracy 0.9986     99.86%
Precision 0.5556     55.56%
   Recall 0.7692     76.92%
 F1-Score 0.6452     64.52%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7575                 3
 Predicted: 1 (Fraud)                  8                10

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    10 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7575 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    8 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    3 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (76.9%) - Missing some fraud cases
  ‚ö†Ô∏è  MODERATE precision (55.6%) - Some false alarms
============================================================

Recall  : 0.7692307692307693
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      7583
           1       0.56      0.77      0.65        13

    accuracy                           1.00      7596
   macro avg       0.78      0.88      0.82      7596
weighted avg       1.00      1.00      1.00      7596

2025-05-24 07:35:43,174 - federated.ipfs - INFO - Added file to IPFS with hash: QmcrbFA2BuHWUU6Qk1RbesibqXphsYX4RLjVGLW8S3ej5b
2025-05-24 07:35:43,175 - federated.ipfs - INFO - Added JSON data to IPFS with hash: QmcrbFA2BuHWUU6Qk1RbesibqXphsYX4RLjVGLW8S3ej5b
2025-05-24 07:35:43,175 - FL-Client-Ensemble - INFO - Stored client data in IPFS: QmcrbFA2BuHWUU6Qk1RbesibqXphsYX4RLjVGLW8S3ej5b
2025-05-24 07:35:43,178 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmcrbFA2BuHWUU6Qk1RbesibqXphsYX4RLjVGLW8S3ej5b
2025-05-24 07:35:43,179 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmcrbFA2BuHWUU6Qk1RbesibqXphsYX4RLjVGLW8S3ej5b
2025-05-24 07:35:43,179 - FL-Client-Ensemble - INFO - Verification - stored data contains keys: ['ensemble_weights', 'base_model_names', 'info', 'metrics']
2025-05-24 07:35:43,179 - FL-Client-Ensemble - INFO - Ensemble weights successfully stored, length: 7
INFO :      Sent reply
2025-05-24 07:35:43,187 - flwr - INFO - Sent reply
INFO :      
2025-05-24 07:35:47,074 - flwr - INFO - 
INFO :      Received: evaluate message 6a340546-62f5-4139-a85a-fa19586da7fc
2025-05-24 07:35:47,077 - flwr - INFO - Received: evaluate message 6a340546-62f5-4139-a85a-fa19586da7fc
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:35:47,078 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:35:47,109 - FL-Client-Ensemble - INFO - Starting evaluation for round 1
2025-05-24 07:35:47,109 - FL-Client-Ensemble - INFO - Using model from IPFS: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:47,109 - FL-Client-Ensemble - INFO - Attempting to evaluate using global ensemble model from IPFS
2025-05-24 07:35:47,112 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:47,113 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:47,113 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 07:35:47,113 - FL-Client-Ensemble - INFO - Evaluating global ensemble with 7 models
2025-05-24 07:35:47,113 - FL-Client-Ensemble - INFO - Ensemble weights: [0.11353686432546849, 0.077767604636423, 0.25233345362983056, 0.18292513379071473, 0.04582085104863068, 0.15054241869701332, 0.17707367387191913]
2025-05-24 07:35:47,113 - FL-Client-Ensemble - INFO - Loading base models from models/client_client-1
Loaded 7 base models from models/client_client-1
2025-05-24 07:35:47,157 - FL-Client-Ensemble - INFO - Successfully loaded 7 base models
2025-05-24 07:35:47,157 - FL-Client-Ensemble - INFO - Generating meta-features for global model evaluation

üåç GLOBAL MODEL EVALUATION - ROUND 1

============================================================
  ROUND 1 - TEST (GLOBAL ENSEMBLE) SET EVALUATION REPORT
============================================================

Dataset: Test (Global Ensemble)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0139          -
 Accuracy 0.9987     99.87%
Precision 0.5882     58.82%
   Recall 0.7692     76.92%
 F1-Score 0.6667     66.67%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7576                 3
 Predicted: 1 (Fraud)                  7                10

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    10 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7576 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    7 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    3 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (76.9%) - Missing some fraud cases
  ‚ö†Ô∏è  MODERATE precision (58.8%) - Some false alarms
============================================================

2025-05-24 07:35:51,348 - FL-Client-Ensemble - INFO - Our contribution: Score=7227.00, Reward=0.000000 ETH, Rank=0
2025-05-24 07:35:51,349 - FL-Client-Ensemble - INFO - Global model evaluation completed - Loss: 0.0139, Precision: 0.5882, Recall: 0.7692, F1: 0.6667
INFO :      Sent reply
2025-05-24 07:35:51,350 - flwr - INFO - Sent reply
INFO :      
2025-05-24 07:35:51,353 - flwr - INFO - 
INFO :      Received: train message 7e24b1ac-e3be-4255-a3e5-6d11a282639a
2025-05-24 07:35:51,355 - flwr - INFO - Received: train message 7e24b1ac-e3be-4255-a3e5-6d11a282639a
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:35:51,355 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 07:35:51,371 - FL-Client-Ensemble - INFO - Round 2: Fine-tuning with aggregated weights
2025-05-24 07:35:51,372 - FL-Client-Ensemble - INFO - Retrieving aggregated weights from IPFS hash: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:51,375 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:51,376 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmXn4nsoVGsNqjvK5MDm36bui9vGbqj7JRTfX7WSShXqrS
2025-05-24 07:35:51,376 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 07:35:51,377 - FL-Client-Ensemble - INFO - Found ensemble weights in global model data: [0.11353686432546849, 0.077767604636423, 0.25233345362983056, 0.18292513379071473, 0.04582085104863068, 0.15054241869701332, 0.17707367387191913]
2025-05-24 07:35:51,377 - FL-Client-Ensemble - INFO - Found base model names in global model data: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 07:35:51,377 - FL-Client-Ensemble - INFO - Fine-tuning with base models: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 07:35:51,378 - FL-Client-Ensemble - INFO - Fine-tuning with aggregated weights: [0.11353686 0.0777676  0.25233345 0.18292513 0.04582085 0.15054242
 0.17707367]
Fine-tuning base models...
/home/cam/flwr/venv/lib/python3.8/site-packages/sklearn/ensemble/_forest.py:435: UserWarning: Warm-start fitting without increasing n_estimators does not fit new trees.
  warn(
Generating meta-features...
I0000 00:00:1748072740.705501   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748072740.769732   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748072740.797876   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748072740.838081   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
Generating validation meta-features...
DEBUG: meta_X_train shape: (90990, 7), type: <class 'numpy.ndarray'>
DEBUG: meta_X_val shape: (3797, 7), type: <class 'numpy.ndarray'>
DEBUG: About to call GA_weighted...
Running GA optimization...
Using provided aggregated weights: [0.11353686 0.0777676  0.25233345 0.18292513 0.04582085 0.15054242
 0.17707367]
Gen 1/5 - best precision: 1.0000
Gen 2/5 - best precision: 1.0000
Gen 3/5 - best precision: 1.0000
Gen 4/5 - best precision: 1.0000
Gen 5/5 - best precision: 1.0000
Recall  : 0.8333333333333334
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      3791
           1       1.00      0.83      0.91         6

    accuracy                           1.00      3797
   macro avg       1.00      0.92      0.95      3797
weighted avg       1.00      1.00      1.00      3797

2025-05-24 08:02:02,589 - FL-Client-Ensemble - INFO - Completed fine-tuning with 7 base models
2025-05-24 08:02:02,589 - FL-Client-Ensemble - INFO - Updated ensemble weights: [0.14338182102473745, 0.0681709747633056, 0.24429347995798428, 0.1533271855788851, 0.0751820539088311, 0.14216870974167814, 0.17347577502457834]

üìà ROUND 2 FINE-TUNING COMPLETED

üìä EVALUATING ON VALIDATION SET AFTER FINE-TUNING...

============================================================
  ROUND 2 - VALIDATION (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Validation (After Fine-tuning)
Total Samples: 3797
Fraud Cases: 6 (0.16%)
Normal Cases: 3791 (99.84%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0131          -
 Accuracy 0.9997     99.97%
Precision 1.0000    100.00%
   Recall 0.8333     83.33%
 F1-Score 0.9091     90.91%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               3791                 1
 Predicted: 1 (Fraud)                  0                 5

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):     5 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  3791 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    0 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (83.3%) - Missing some fraud cases
  ‚úÖ GOOD precision (100.0%) - Low false alarm rate
============================================================


üß™ EVALUATING ON TEST SET AFTER FINE-TUNING...

============================================================
  ROUND 2 - TEST (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Test (After Fine-tuning)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0153          -
 Accuracy 0.9987     99.87%
Precision 0.5882     58.82%
   Recall 0.7692     76.92%
 F1-Score 0.6667     66.67%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7576                 3
 Predicted: 1 (Fraud)                  7                10

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    10 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7576 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    7 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    3 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (76.9%) - Missing some fraud cases
  ‚ö†Ô∏è  MODERATE precision (58.8%) - Some false alarms
============================================================

Recall  : 0.7692307692307693
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      7583
           1       0.59      0.77      0.67        13

    accuracy                           1.00      7596
   macro avg       0.79      0.88      0.83      7596
weighted avg       1.00      1.00      1.00      7596

2025-05-24 08:02:11,727 - federated.ipfs - INFO - Added file to IPFS with hash: QmWPK3B8miEKJd7ekWJXitsPwuaGWecvUFWtqjoVuc1nuJ
2025-05-24 08:02:11,728 - federated.ipfs - INFO - Added JSON data to IPFS with hash: QmWPK3B8miEKJd7ekWJXitsPwuaGWecvUFWtqjoVuc1nuJ
2025-05-24 08:02:11,728 - FL-Client-Ensemble - INFO - Stored client data in IPFS: QmWPK3B8miEKJd7ekWJXitsPwuaGWecvUFWtqjoVuc1nuJ
2025-05-24 08:02:11,730 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmWPK3B8miEKJd7ekWJXitsPwuaGWecvUFWtqjoVuc1nuJ
2025-05-24 08:02:11,731 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmWPK3B8miEKJd7ekWJXitsPwuaGWecvUFWtqjoVuc1nuJ
2025-05-24 08:02:11,731 - FL-Client-Ensemble - INFO - Verification - stored data contains keys: ['ensemble_weights', 'base_model_names', 'info', 'metrics']
2025-05-24 08:02:11,731 - FL-Client-Ensemble - INFO - Ensemble weights successfully stored, length: 7
INFO :      Sent reply
2025-05-24 08:02:11,733 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:02:14,948 - flwr - INFO - 
INFO :      Received: evaluate message 43c59d84-6add-45e8-b0ac-233674dcef1e
2025-05-24 08:02:14,948 - flwr - INFO - Received: evaluate message 43c59d84-6add-45e8-b0ac-233674dcef1e
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:02:14,949 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:02:14,973 - FL-Client-Ensemble - INFO - Starting evaluation for round 2
2025-05-24 08:02:14,973 - FL-Client-Ensemble - INFO - Using model from IPFS: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:14,974 - FL-Client-Ensemble - INFO - Attempting to evaluate using global ensemble model from IPFS
2025-05-24 08:02:14,978 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:14,980 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:14,980 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:02:14,980 - FL-Client-Ensemble - INFO - Evaluating global ensemble with 7 models
2025-05-24 08:02:14,980 - FL-Client-Ensemble - INFO - Ensemble weights: [0.09834125984957352, 0.0975457282789974, 0.25501165581010377, 0.07666750850679883, 0.15003903285522482, 0.18337960133467382, 0.13901521336462788]
2025-05-24 08:02:14,980 - FL-Client-Ensemble - INFO - Generating meta-features for global model evaluation

üåç GLOBAL MODEL EVALUATION - ROUND 2

============================================================
  ROUND 2 - TEST (GLOBAL ENSEMBLE) SET EVALUATION REPORT
============================================================

Dataset: Test (Global Ensemble)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0135          -
 Accuracy 0.9987     99.87%
Precision 0.5882     58.82%
   Recall 0.7692     76.92%
 F1-Score 0.6667     66.67%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7576                 3
 Predicted: 1 (Fraud)                  7                10

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    10 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7576 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    7 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    3 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (76.9%) - Missing some fraud cases
  ‚ö†Ô∏è  MODERATE precision (58.8%) - Some false alarms
============================================================

2025-05-24 08:02:18,897 - FL-Client-Ensemble - INFO - Our contribution: Score=7227.00, Reward=0.000000 ETH, Rank=0
2025-05-24 08:02:18,897 - FL-Client-Ensemble - INFO - Global model evaluation completed - Loss: 0.0135, Precision: 0.5882, Recall: 0.7692, F1: 0.6667
INFO :      Sent reply
2025-05-24 08:02:18,898 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:02:18,907 - flwr - INFO - 
INFO :      Received: train message a4d0f7a7-ce56-4c69-80bb-df2b5210245f
2025-05-24 08:02:18,911 - flwr - INFO - Received: train message a4d0f7a7-ce56-4c69-80bb-df2b5210245f
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:02:18,912 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:02:18,940 - FL-Client-Ensemble - INFO - Round 3: Fine-tuning with aggregated weights
2025-05-24 08:02:18,941 - FL-Client-Ensemble - INFO - Retrieving aggregated weights from IPFS hash: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:18,944 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:18,944 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmeiWPu4s1ranLzJLJf9MgHQu9mjnEA1TzAn4UdpVRo5Vi
2025-05-24 08:02:18,944 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:02:18,944 - FL-Client-Ensemble - INFO - Found ensemble weights in global model data: [0.09834125984957352, 0.0975457282789974, 0.25501165581010377, 0.07666750850679883, 0.15003903285522482, 0.18337960133467382, 0.13901521336462788]
2025-05-24 08:02:18,945 - FL-Client-Ensemble - INFO - Found base model names in global model data: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:02:18,945 - FL-Client-Ensemble - INFO - Fine-tuning with base models: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:02:18,945 - FL-Client-Ensemble - INFO - Fine-tuning with aggregated weights: [0.09834126 0.09754573 0.25501166 0.07666751 0.15003903 0.1833796
 0.13901521]
Fine-tuning base models...
/home/cam/flwr/venv/lib/python3.8/site-packages/sklearn/ensemble/_forest.py:435: UserWarning: Warm-start fitting without increasing n_estimators does not fit new trees.
  warn(
Generating meta-features...
I0000 00:00:1748074333.762014   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748074333.790175   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748074333.809946   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748074333.834395   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
Generating validation meta-features...
DEBUG: meta_X_train shape: (90990, 7), type: <class 'numpy.ndarray'>
DEBUG: meta_X_val shape: (3797, 7), type: <class 'numpy.ndarray'>
DEBUG: About to call GA_weighted...
Running GA optimization...
Using provided aggregated weights: [0.09834126 0.09754573 0.25501166 0.07666751 0.15003903 0.1833796
 0.13901521]
Gen 1/5 - best precision: 1.0000
Gen 2/5 - best precision: 1.0000
Gen 3/5 - best precision: 1.0000
Gen 4/5 - best precision: 1.0000
Gen 5/5 - best precision: 1.0000
Recall  : 0.8333333333333334
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      3791
           1       1.00      0.83      0.91         6

    accuracy                           1.00      3797
   macro avg       1.00      0.92      0.95      3797
weighted avg       1.00      1.00      1.00      3797

2025-05-24 08:28:26,579 - FL-Client-Ensemble - INFO - Completed fine-tuning with 7 base models
2025-05-24 08:28:26,579 - FL-Client-Ensemble - INFO - Updated ensemble weights: [0.11718206302819267, 0.08193271812010124, 0.17030689635158933, 0.11157234068782307, 0.07527462162134657, 0.20583960987195524, 0.23789175031899187]

üìà ROUND 3 FINE-TUNING COMPLETED

üìä EVALUATING ON VALIDATION SET AFTER FINE-TUNING...

============================================================
  ROUND 3 - VALIDATION (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Validation (After Fine-tuning)
Total Samples: 3797
Fraud Cases: 6 (0.16%)
Normal Cases: 3791 (99.84%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0117          -
 Accuracy 0.9997     99.97%
Precision 1.0000    100.00%
   Recall 0.8333     83.33%
 F1-Score 0.9091     90.91%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               3791                 1
 Predicted: 1 (Fraud)                  0                 5

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):     5 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  3791 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    0 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (83.3%) - Missing some fraud cases
  ‚úÖ GOOD precision (100.0%) - Low false alarm rate
============================================================


üß™ EVALUATING ON TEST SET AFTER FINE-TUNING...

============================================================
  ROUND 3 - TEST (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Test (After Fine-tuning)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0139          -
 Accuracy 0.9986     99.86%
Precision 0.5556     55.56%
   Recall 0.7692     76.92%
 F1-Score 0.6452     64.52%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7575                 3
 Predicted: 1 (Fraud)                  8                10

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    10 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7575 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    8 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    3 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (76.9%) - Missing some fraud cases
  ‚ö†Ô∏è  MODERATE precision (55.6%) - Some false alarms
============================================================

Recall  : 0.7692307692307693
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      7583
           1       0.56      0.77      0.65        13

    accuracy                           1.00      7596
   macro avg       0.78      0.88      0.82      7596
weighted avg       1.00      1.00      1.00      7596

2025-05-24 08:28:36,219 - federated.ipfs - INFO - Added file to IPFS with hash: QmYor7mGUrf3vqca2vr1vJdn6njFp3fT1TqwbgdxG2Z2MX
2025-05-24 08:28:36,220 - federated.ipfs - INFO - Added JSON data to IPFS with hash: QmYor7mGUrf3vqca2vr1vJdn6njFp3fT1TqwbgdxG2Z2MX
2025-05-24 08:28:36,220 - FL-Client-Ensemble - INFO - Stored client data in IPFS: QmYor7mGUrf3vqca2vr1vJdn6njFp3fT1TqwbgdxG2Z2MX
2025-05-24 08:28:36,222 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmYor7mGUrf3vqca2vr1vJdn6njFp3fT1TqwbgdxG2Z2MX
2025-05-24 08:28:36,222 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmYor7mGUrf3vqca2vr1vJdn6njFp3fT1TqwbgdxG2Z2MX
2025-05-24 08:28:36,222 - FL-Client-Ensemble - INFO - Verification - stored data contains keys: ['ensemble_weights', 'base_model_names', 'info', 'metrics']
2025-05-24 08:28:36,222 - FL-Client-Ensemble - INFO - Ensemble weights successfully stored, length: 7
INFO :      Sent reply
2025-05-24 08:28:36,224 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:28:40,138 - flwr - INFO - 
INFO :      Received: evaluate message b84bfb7a-bc1b-434a-b541-4872bd8a9fde
2025-05-24 08:28:40,138 - flwr - INFO - Received: evaluate message b84bfb7a-bc1b-434a-b541-4872bd8a9fde
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:28:40,138 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:28:40,167 - FL-Client-Ensemble - INFO - Starting evaluation for round 3
2025-05-24 08:28:40,168 - FL-Client-Ensemble - INFO - Using model from IPFS: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:40,168 - FL-Client-Ensemble - INFO - Attempting to evaluate using global ensemble model from IPFS
2025-05-24 08:28:40,172 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:40,172 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:40,172 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:28:40,172 - FL-Client-Ensemble - INFO - Evaluating global ensemble with 7 models
2025-05-24 08:28:40,172 - FL-Client-Ensemble - INFO - Ensemble weights: [0.11409526877677836, 0.07301107187303241, 0.19638792708073263, 0.10042878972416125, 0.12176672271401215, 0.19787623813249647, 0.19643398169878667]
2025-05-24 08:28:40,173 - FL-Client-Ensemble - INFO - Generating meta-features for global model evaluation

üåç GLOBAL MODEL EVALUATION - ROUND 3

============================================================
  ROUND 3 - TEST (GLOBAL ENSEMBLE) SET EVALUATION REPORT
============================================================

Dataset: Test (Global Ensemble)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0135          -
 Accuracy 0.9987     99.87%
Precision 0.5882     58.82%
   Recall 0.7692     76.92%
 F1-Score 0.6667     66.67%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7576                 3
 Predicted: 1 (Fraud)                  7                10

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    10 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7576 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    7 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    3 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (76.9%) - Missing some fraud cases
  ‚ö†Ô∏è  MODERATE precision (58.8%) - Some false alarms
============================================================

2025-05-24 08:28:44,345 - FL-Client-Ensemble - INFO - Our contribution: Score=7227.00, Reward=0.000000 ETH, Rank=0
2025-05-24 08:28:44,346 - FL-Client-Ensemble - INFO - Global model evaluation completed - Loss: 0.0135, Precision: 0.5882, Recall: 0.7692, F1: 0.6667
INFO :      Sent reply
2025-05-24 08:28:44,346 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:28:44,350 - flwr - INFO - 
INFO :      Received: train message 97ac4a5a-3659-43d5-8b51-84781d4c8f06
2025-05-24 08:28:44,350 - flwr - INFO - Received: train message 97ac4a5a-3659-43d5-8b51-84781d4c8f06
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:28:44,350 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:28:44,378 - FL-Client-Ensemble - INFO - Round 4: Fine-tuning with aggregated weights
2025-05-24 08:28:44,379 - FL-Client-Ensemble - INFO - Retrieving aggregated weights from IPFS hash: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:44,381 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:44,381 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmbWno9PeLsC6wscRhT7pF9RxUqJhCNzjWNmoWpysHehKb
2025-05-24 08:28:44,381 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:28:44,381 - FL-Client-Ensemble - INFO - Found ensemble weights in global model data: [0.11409526877677836, 0.07301107187303241, 0.19638792708073263, 0.10042878972416125, 0.12176672271401215, 0.19787623813249647, 0.19643398169878667]
2025-05-24 08:28:44,381 - FL-Client-Ensemble - INFO - Found base model names in global model data: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:28:44,381 - FL-Client-Ensemble - INFO - Fine-tuning with base models: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:28:44,381 - FL-Client-Ensemble - INFO - Fine-tuning with aggregated weights: [0.11409527 0.07301107 0.19638793 0.10042879 0.12176672 0.19787624
 0.19643398]
Fine-tuning base models...
/home/cam/flwr/venv/lib/python3.8/site-packages/sklearn/ensemble/_forest.py:435: UserWarning: Warm-start fitting without increasing n_estimators does not fit new trees.
  warn(
Generating meta-features...
I0000 00:00:1748075972.477031   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748075972.518178   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748075972.558248   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748075972.585744   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
Generating validation meta-features...
DEBUG: meta_X_train shape: (90990, 7), type: <class 'numpy.ndarray'>
DEBUG: meta_X_val shape: (3797, 7), type: <class 'numpy.ndarray'>
DEBUG: About to call GA_weighted...
Running GA optimization...
Using provided aggregated weights: [0.11409527 0.07301107 0.19638793 0.10042879 0.12176672 0.19787624
 0.19643398]
Gen 1/5 - best precision: 1.0000
Gen 2/5 - best precision: 1.0000
Gen 3/5 - best precision: 1.0000
Gen 4/5 - best precision: 1.0000
Gen 5/5 - best precision: 1.0000
Recall  : 0.8333333333333334
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      3791
           1       1.00      0.83      0.91         6

    accuracy                           1.00      3797
   macro avg       1.00      0.92      0.95      3797
weighted avg       1.00      1.00      1.00      3797

2025-05-24 08:54:29,711 - FL-Client-Ensemble - INFO - Completed fine-tuning with 7 base models
2025-05-24 08:54:29,711 - FL-Client-Ensemble - INFO - Updated ensemble weights: [0.11930412026906623, 0.0978973334189589, 0.28541775749564635, 0.09050876519374239, 0.139422852516414, 0.035749872946564565, 0.23169929815960766]

üìà ROUND 4 FINE-TUNING COMPLETED

üìä EVALUATING ON VALIDATION SET AFTER FINE-TUNING...

============================================================
  ROUND 4 - VALIDATION (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Validation (After Fine-tuning)
Total Samples: 3797
Fraud Cases: 6 (0.16%)
Normal Cases: 3791 (99.84%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0127          -
 Accuracy 0.9997     99.97%
Precision 1.0000    100.00%
   Recall 0.8333     83.33%
 F1-Score 0.9091     90.91%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               3791                 1
 Predicted: 1 (Fraud)                  0                 5

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):     5 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  3791 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    0 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (83.3%) - Missing some fraud cases
  ‚úÖ GOOD precision (100.0%) - Low false alarm rate
============================================================


üß™ EVALUATING ON TEST SET AFTER FINE-TUNING...

============================================================
  ROUND 4 - TEST (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Test (After Fine-tuning)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0148          -
 Accuracy 0.9986     99.86%
Precision 0.5556     55.56%
   Recall 0.7692     76.92%
 F1-Score 0.6452     64.52%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7575                 3
 Predicted: 1 (Fraud)                  8                10

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    10 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7575 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    8 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    3 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (76.9%) - Missing some fraud cases
  ‚ö†Ô∏è  MODERATE precision (55.6%) - Some false alarms
============================================================

Recall  : 0.7692307692307693
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      7583
           1       0.56      0.77      0.65        13

    accuracy                           1.00      7596
   macro avg       0.78      0.88      0.82      7596
weighted avg       1.00      1.00      1.00      7596

2025-05-24 08:54:38,659 - federated.ipfs - INFO - Added file to IPFS with hash: QmSgHmqYnRuaXs8FAhaCoaBFG9gRwfHCrUh2cmv7P9vpQx
2025-05-24 08:54:38,659 - federated.ipfs - INFO - Added JSON data to IPFS with hash: QmSgHmqYnRuaXs8FAhaCoaBFG9gRwfHCrUh2cmv7P9vpQx
2025-05-24 08:54:38,660 - FL-Client-Ensemble - INFO - Stored client data in IPFS: QmSgHmqYnRuaXs8FAhaCoaBFG9gRwfHCrUh2cmv7P9vpQx
2025-05-24 08:54:38,664 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmSgHmqYnRuaXs8FAhaCoaBFG9gRwfHCrUh2cmv7P9vpQx
2025-05-24 08:54:38,665 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmSgHmqYnRuaXs8FAhaCoaBFG9gRwfHCrUh2cmv7P9vpQx
2025-05-24 08:54:38,665 - FL-Client-Ensemble - INFO - Verification - stored data contains keys: ['ensemble_weights', 'base_model_names', 'info', 'metrics']
2025-05-24 08:54:38,665 - FL-Client-Ensemble - INFO - Ensemble weights successfully stored, length: 7
INFO :      Sent reply
2025-05-24 08:54:38,666 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:54:40,489 - flwr - INFO - 
INFO :      Received: evaluate message fc47214c-6c23-4606-b5fe-232977350082
2025-05-24 08:54:40,489 - flwr - INFO - Received: evaluate message fc47214c-6c23-4606-b5fe-232977350082
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:54:40,489 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:54:40,520 - FL-Client-Ensemble - INFO - Starting evaluation for round 4
2025-05-24 08:54:40,520 - FL-Client-Ensemble - INFO - Using model from IPFS: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:40,520 - FL-Client-Ensemble - INFO - Attempting to evaluate using global ensemble model from IPFS
2025-05-24 08:54:40,525 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:40,525 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:40,526 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:54:40,526 - FL-Client-Ensemble - INFO - Evaluating global ensemble with 7 models
2025-05-24 08:54:40,526 - FL-Client-Ensemble - INFO - Ensemble weights: [0.08439130960966272, 0.13613491606341205, 0.22378192184430135, 0.07694620381027872, 0.15787929673498036, 0.14008673053432036, 0.1807796214030445]
2025-05-24 08:54:40,526 - FL-Client-Ensemble - INFO - Generating meta-features for global model evaluation

üåç GLOBAL MODEL EVALUATION - ROUND 4

============================================================
  ROUND 4 - TEST (GLOBAL ENSEMBLE) SET EVALUATION REPORT
============================================================

Dataset: Test (Global Ensemble)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0139          -
 Accuracy 0.9987     99.87%
Precision 0.5882     58.82%
   Recall 0.7692     76.92%
 F1-Score 0.6667     66.67%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7576                 3
 Predicted: 1 (Fraud)                  7                10

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    10 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7576 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    7 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    3 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (76.9%) - Missing some fraud cases
  ‚ö†Ô∏è  MODERATE precision (58.8%) - Some false alarms
============================================================

2025-05-24 08:54:44,541 - FL-Client-Ensemble - INFO - Our contribution: Score=7227.00, Reward=0.000000 ETH, Rank=0
2025-05-24 08:54:44,541 - FL-Client-Ensemble - INFO - Global model evaluation completed - Loss: 0.0139, Precision: 0.5882, Recall: 0.7692, F1: 0.6667
INFO :      Sent reply
2025-05-24 08:54:44,542 - flwr - INFO - Sent reply
INFO :      
2025-05-24 08:54:44,547 - flwr - INFO - 
INFO :      Received: train message e53c2aeb-7fd8-424c-aee1-a8e46f1ce3f2
2025-05-24 08:54:44,554 - flwr - INFO - Received: train message e53c2aeb-7fd8-424c-aee1-a8e46f1ce3f2
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:54:44,558 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 08:54:44,606 - FL-Client-Ensemble - INFO - Round 5: Fine-tuning with aggregated weights
2025-05-24 08:54:44,606 - FL-Client-Ensemble - INFO - Retrieving aggregated weights from IPFS hash: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:44,610 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:44,610 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmefMmiCWWKVqXGd5GuFrHNYGpbnAcf7ZN7XNZWeARtShC
2025-05-24 08:54:44,610 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 08:54:44,610 - FL-Client-Ensemble - INFO - Found ensemble weights in global model data: [0.08439130960966272, 0.13613491606341205, 0.22378192184430135, 0.07694620381027872, 0.15787929673498036, 0.14008673053432036, 0.1807796214030445]
2025-05-24 08:54:44,610 - FL-Client-Ensemble - INFO - Found base model names in global model data: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:54:44,611 - FL-Client-Ensemble - INFO - Fine-tuning with base models: ['lr', 'svc', 'rf', 'knn', 'catboost', 'lgbm', 'xgb']
2025-05-24 08:54:44,611 - FL-Client-Ensemble - INFO - Fine-tuning with aggregated weights: [0.08439131 0.13613492 0.22378192 0.0769462  0.1578793  0.14008673
 0.18077962]
Fine-tuning base models...
/home/cam/flwr/venv/lib/python3.8/site-packages/sklearn/ensemble/_forest.py:435: UserWarning: Warm-start fitting without increasing n_estimators does not fit new trees.
  warn(
Generating meta-features...
I0000 00:00:1748077469.767359   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748077469.796909   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748077469.826292   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1748077469.862096   40742 fork_posix.cc:75] Other threads are currently calling into gRPC, skipping fork() handlers
Generating validation meta-features...
DEBUG: meta_X_train shape: (90990, 7), type: <class 'numpy.ndarray'>
DEBUG: meta_X_val shape: (3797, 7), type: <class 'numpy.ndarray'>
DEBUG: About to call GA_weighted...
Running GA optimization...
Using provided aggregated weights: [0.08439131 0.13613492 0.22378192 0.0769462  0.1578793  0.14008673
 0.18077962]
Gen 1/5 - best precision: 1.0000
Gen 2/5 - best precision: 1.0000
Gen 3/5 - best precision: 1.0000
Gen 4/5 - best precision: 1.0000
Gen 5/5 - best precision: 1.0000
Recall  : 0.8333333333333334
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      3791
           1       1.00      0.83      0.91         6

    accuracy                           1.00      3797
   macro avg       1.00      0.92      0.95      3797
weighted avg       1.00      1.00      1.00      3797

2025-05-24 09:21:10,903 - FL-Client-Ensemble - INFO - Completed fine-tuning with 7 base models
2025-05-24 09:21:10,903 - FL-Client-Ensemble - INFO - Updated ensemble weights: [0.08647018593123851, 0.0857998391744514, 0.2917045531319662, 0.126031800630773, 0.05279057935785405, 0.2157495726046455, 0.14145346916907142]

üìà ROUND 5 FINE-TUNING COMPLETED

üìä EVALUATING ON VALIDATION SET AFTER FINE-TUNING...

============================================================
  ROUND 5 - VALIDATION (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Validation (After Fine-tuning)
Total Samples: 3797
Fraud Cases: 6 (0.16%)
Normal Cases: 3791 (99.84%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0103          -
 Accuracy 0.9997     99.97%
Precision 1.0000    100.00%
   Recall 0.8333     83.33%
 F1-Score 0.9091     90.91%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               3791                 1
 Predicted: 1 (Fraud)                  0                 5

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):     5 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  3791 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    0 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    1 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (83.3%) - Missing some fraud cases
  ‚úÖ GOOD precision (100.0%) - Low false alarm rate
============================================================


üß™ EVALUATING ON TEST SET AFTER FINE-TUNING...

============================================================
  ROUND 5 - TEST (AFTER FINE-TUNING) SET EVALUATION REPORT
============================================================

Dataset: Test (After Fine-tuning)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0124          -
 Accuracy 0.9987     99.87%
Precision 0.5882     58.82%
   Recall 0.7692     76.92%
 F1-Score 0.6667     66.67%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7576                 3
 Predicted: 1 (Fraud)                  7                10

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    10 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7576 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    7 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    3 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (76.9%) - Missing some fraud cases
  ‚ö†Ô∏è  MODERATE precision (58.8%) - Some false alarms
============================================================

Recall  : 0.7692307692307693
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      7583
           1       0.59      0.77      0.67        13

    accuracy                           1.00      7596
   macro avg       0.79      0.88      0.83      7596
weighted avg       1.00      1.00      1.00      7596

2025-05-24 09:21:20,526 - federated.ipfs - INFO - Added file to IPFS with hash: QmT1ZZ3tUaEY739fKL6cEQULwTxkNkgPgAwjdDK3pC7Eif
2025-05-24 09:21:20,526 - federated.ipfs - INFO - Added JSON data to IPFS with hash: QmT1ZZ3tUaEY739fKL6cEQULwTxkNkgPgAwjdDK3pC7Eif
2025-05-24 09:21:20,526 - FL-Client-Ensemble - INFO - Stored client data in IPFS: QmT1ZZ3tUaEY739fKL6cEQULwTxkNkgPgAwjdDK3pC7Eif
2025-05-24 09:21:20,529 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmT1ZZ3tUaEY739fKL6cEQULwTxkNkgPgAwjdDK3pC7Eif
2025-05-24 09:21:20,529 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmT1ZZ3tUaEY739fKL6cEQULwTxkNkgPgAwjdDK3pC7Eif
2025-05-24 09:21:20,530 - FL-Client-Ensemble - INFO - Verification - stored data contains keys: ['ensemble_weights', 'base_model_names', 'info', 'metrics']
2025-05-24 09:21:20,530 - FL-Client-Ensemble - INFO - Ensemble weights successfully stored, length: 7
INFO :      Sent reply
2025-05-24 09:21:20,531 - flwr - INFO - Sent reply
INFO :      
2025-05-24 09:21:22,165 - flwr - INFO - 
INFO :      Received: evaluate message e75c8317-b133-4ac6-a117-2af5ae793349
2025-05-24 09:21:22,165 - flwr - INFO - Received: evaluate message e75c8317-b133-4ac6-a117-2af5ae793349
WARNING :   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 09:21:22,166 - flwr - WARNING - Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
2025-05-24 09:21:22,184 - FL-Client-Ensemble - INFO - Starting evaluation for round 5
2025-05-24 09:21:22,184 - FL-Client-Ensemble - INFO - Using model from IPFS: QmdvEfnx4ff8aHMQp6N5E3zfeGaF6v7M6gpNCgDvGmfZtU
2025-05-24 09:21:22,185 - FL-Client-Ensemble - INFO - Attempting to evaluate using global ensemble model from IPFS
2025-05-24 09:21:22,187 - federated.ipfs - INFO - Retrieved file from IPFS with hash: QmdvEfnx4ff8aHMQp6N5E3zfeGaF6v7M6gpNCgDvGmfZtU
2025-05-24 09:21:22,188 - federated.ipfs - INFO - Retrieved and parsed JSON data from IPFS hash: QmdvEfnx4ff8aHMQp6N5E3zfeGaF6v7M6gpNCgDvGmfZtU
2025-05-24 09:21:22,188 - FL-Client-Ensemble - INFO - Retrieved global model data with keys: ['ensemble_weights', 'base_model_names', 'client_contributions', 'info']
2025-05-24 09:21:22,188 - FL-Client-Ensemble - INFO - Evaluating global ensemble with 7 models
2025-05-24 09:21:22,188 - FL-Client-Ensemble - INFO - Ensemble weights: [0.07438168502614205, 0.10082179011437978, 0.24497577227480016, 0.09425212480387338, 0.18172655867353302, 0.17216271413270223, 0.1316793549745694]
2025-05-24 09:21:22,188 - FL-Client-Ensemble - INFO - Generating meta-features for global model evaluation

üåç GLOBAL MODEL EVALUATION - ROUND 5

============================================================
  ROUND 5 - TEST (GLOBAL ENSEMBLE) SET EVALUATION REPORT
============================================================

Dataset: Test (Global Ensemble)
Total Samples: 7596
Fraud Cases: 13 (0.17%)
Normal Cases: 7583 (99.83%)

üìä PERFORMANCE METRICS:
   Metric  Value Percentage
     Loss 0.0123          -
 Accuracy 0.9987     99.87%
Precision 0.5882     58.82%
   Recall 0.7692     76.92%
 F1-Score 0.6667     66.67%

üîç CONFUSION MATRIX:
                      Actual: 0 (Normal) Actual: 1 (Fraud)
Predicted: 0 (Normal)               7576                 3
 Predicted: 1 (Fraud)                  7                10

üìà DETAILED BREAKDOWN:
  ‚Ä¢ True Positives (TP):    10 - Correctly identified fraud cases
  ‚Ä¢ True Negatives (TN):  7576 - Correctly identified normal cases
  ‚Ä¢ False Positives (FP):    7 - Normal cases incorrectly flagged as fraud
  ‚Ä¢ False Negatives (FN):    3 - Fraud cases missed (most critical!)

üí° INTERPRETATION:
  ‚ö†Ô∏è  GOOD recall (76.9%) - Missing some fraud cases
  ‚ö†Ô∏è  MODERATE precision (58.8%) - Some false alarms
============================================================

2025-05-24 09:21:26,710 - FL-Client-Ensemble - INFO - Our contribution: Score=7227.00, Reward=0.000000 ETH, Rank=0
2025-05-24 09:21:26,710 - FL-Client-Ensemble - INFO - Global model evaluation completed - Loss: 0.0123, Precision: 0.5882, Recall: 0.7692, F1: 0.6667
INFO :      Sent reply
2025-05-24 09:21:26,711 - flwr - INFO - Sent reply
INFO :      
2025-05-24 09:21:26,757 - flwr - INFO - 
INFO :      Received: reconnect message 680cf4ce-c138-4802-976e-6c3710538498
2025-05-24 09:21:26,757 - flwr - INFO - Received: reconnect message 680cf4ce-c138-4802-976e-6c3710538498
2025-05-24 09:21:26,816 - flwr - DEBUG - gRPC channel closed
INFO :      Disconnect and shut down
2025-05-24 09:21:26,820 - flwr - INFO - Disconnect and shut down
2025-05-24 09:21:26,838 - FL-Client-Ensemble - INFO - Saved metrics history to metrics/client-1/metrics_history.json
2025-05-24 09:21:26,843 - FL-Client-Ensemble - INFO - Client client-1 completed federated learning with GA-Stacking